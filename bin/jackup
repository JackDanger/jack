#!/usr/bin/env ruby

require 'rubygems'
gem 'clip'
require 'clip'
gem 'johnson'
require 'johnson'
gem 'rack'
require 'rack'

usage = "Usage: jackup my_javascript_app.js [rack options]"

options = Clip do |p|
  p.optional 'o', 'Host', :desc => 'listen on HOST (default: 127.0.0.1)', :default => '127.0.0.1'
  p.optional 'p', 'Port', :desc => 'use PORT (default: 9292)', :default => 9292 do |v|
    v.to_i # always deal with integers
  end
end

BASE    = File.expand_path(File.join(File.dirname(__FILE__), '..'))
$LOAD_PATH << File.join(BASE, 'lib')

if options.valid? && options.remainder.size > 0
  rt = Johnson.load(File.join(BASE, 'lib', 'jack.js'))
  rt['Jack'].BASE = BASE
  rt['Jack'].up(options.remainder, { :Port => 1337, :Host => '127.0.0.1' })
else
  $stderr.puts options.to_s
end
